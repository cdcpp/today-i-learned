# 2025-07-11 TIL

## 학습 내용 (Learning Source)

-   김영한님의 **'스프링 입문'** 수강 (AOP가 필요한 상황)
-   과거 경험을 통해, AOP의 필요성을 다시 한번 복기했다.

---

## 경험: AOP를 활용한 '불충분한 인가' 웹 취약점 해결 사례

과거 '스포츠토토코리아'의 판매점 관리 시스템에서, 특정 경로(`/sysm/**`)에 대한 '불충분한 인가' 웹 취약점이 발견된 적이 있다. 당시 스프링 시큐리티를 적용할 수 없는 레거시 환경에서, 나는 AOP를 활용하여 이 문제를 해결한 경험이 있다.

### 문제 상황 (Core Concern)

-   관리자 페이지(`/sysm/`) 하위의 모든 URL에 대해, 사용자의 세션 권한만으로는 접근 제어가 불충분했다.
-   예를 들어, 같은 '관리자'라도 '슈퍼 관리자'와 '배치 관리자'가 접근할 수 있는 메뉴가 달라야 했다.
-   이러한 **'URL별 세분화된 권한 체크 로직'**을 모든 컨트롤러 메소드에 일일이 추가하는 것은, 코드 중복과 유지보수 문제를 야기하는 최악의 방법이었다.

### 해결 전략: AOP를 이용한 '공통 관심 사항' 분리

나는 '권한 체크'라는 로직을 **'공통 관심 사항(Cross-Cutting Concern)'**으로 정의하고, AOP를 통해 기존 비즈니스 로직에서 완전히 분리해냈다.

1.  **데이터베이스 설계:**
    -   URL 패턴과, 해당 URL에 접근하는 데 필요한 '권한 등급'을 매핑하는 '권한 테이블'을 설계하고 데이터를 insert했다.

2.  **AOP Aspect 구현:**
    -   **`@Around("execution(* com.mycompany..*Controller.*(..))")`** 와 같은 Pointcut을 설정하여, 특정 경로의 모든 컨트롤러 메소드 실행 '전후'에 개입하도록 했다.

3.  **핵심 로직 (`ProceedingJoinPoint`):**
    -   메소드가 실행되기 **전 (`joinPoint.proceed()` 이전)**, 다음 로직을 수행했다.
        1.  사용자가 접근하려는 URL 정보를 가져온다.
        2.  DB의 '권한 테이블'에서 해당 URL에 필요한 권한 등급을 조회한다.
        3.  사용자 세션에서 현재 사용자의 권한 등급을 가져온다.
        4.  **두 권한을 비교하여, 일치하지 않으면 예외(Exception)를 발생시켜 메소드 실행을 차단**했다.
        5.  권한이 일치하는 경우에만, `joinPoint.proceed()`를 호출하여 원래의 컨트롤러 메소드를 실행시켰다.

### 오늘의 교훈

> AOP는 단순히 '시간 측정'이나 '로그' 같은 부가 기능에만 쓰이는 기술이 아니다. **'보안', '트랜잭션'과 같이, 여러 비즈니스 로직에 공통적으로 적용되어야 하지만, 핵심 로직과 섞이면 코드를 더럽히는 '관심사'를 분리**하여, 코드의 유지보수성과 재사용성을 높이는 매우 강력한 아키텍처 설계 도구다.

> 차후에 진행할 개인 프로젝트에서는 이전에 경험해봤던 스프링 시큐리티를 적용해보자(filterChain 구현). 